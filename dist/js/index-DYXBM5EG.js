var I=Object.defineProperty,G=Object.defineProperties;var J=Object.getOwnPropertyDescriptors;var H=Object.getOwnPropertySymbols;var K=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable;var P=(i,n,a)=>n in i?I(i,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[n]=a,_=(i,n)=>{for(var a in n||(n={}))K.call(n,a)&&P(i,a,n[a]);if(H)for(var a of H(n))O.call(n,a)&&P(i,a,n[a]);return i},S=(i,n)=>G(i,J(n));var k=(i,n,a)=>new Promise((g,b)=>{var d=o=>{try{p(a.next(o))}catch(v){b(v)}},w=o=>{try{p(a.throw(o))}catch(v){b(v)}},p=o=>o.done?g(o.value):Promise.resolve(o.value).then(d,w);p((a=a.apply(i,n)).next())});import{cA as h,cB as F,ay as Q,cC as W,cD as u,bu as X}from"./bootstrap-CPnRZazZ.js";import{m as C}from"./client-DtYIytis.js";import{a4 as Y,P as y,J as Z,a9 as ee,av as f,ab as x,aB as e,aq as L,ai as te,aA as m,F as B,aC as $,b2 as se,aj as c,aV as U}from"../jse/index-index-DUSCGC6b.js";const oe={class:"mira-library"},le={class:"flex justify-between items-center mb-6"},ne={class:"flex gap-4 mb-6"},ae={class:"relative"},re={key:0,class:"rounded-lg shadow-sm"},ie={class:"animate-pulse"},de={key:1,class:"rounded-lg shadow-sm overflow-hidden"},ue={class:"overflow-x-auto"},ce={class:"min-w-full divide-y divide-gray-200"},pe={class:""},ve={class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider"},me=["checked","indeterminate"],fe={class:"divide-y divide-gray-200"},xe={class:"px-6 py-4 whitespace-nowrap"},be=["checked","onChange"],ge={class:"px-6 py-4 whitespace-nowrap"},he={class:"flex items-center"},ye={class:"text-sm font-medium"},we={key:0,class:"text-sm"},ke={class:"px-6 py-4"},Ce=["title"],_e={class:"px-6 py-4 whitespace-nowrap"},Le={class:"px-6 py-4 whitespace-nowrap"},Ue={class:"px-6 py-4 whitespace-nowrap text-sm"},Ve={class:"px-6 py-4 whitespace-nowrap text-sm"},De={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},Be={class:"flex items-center justify-end space-x-2"},Me=["onClick"],He=["onClick"],Pe=["onClick","disabled"],Se={key:0},Fe={colspan:"8",class:"px-6 py-12 text-center"},$e={class:""},Re={class:"text-lg font-medium"},qe={class:"text-sm mt-1"},Ae={key:2,class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"},Ne={class:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md"},je={class:"mt-3"},ze={class:"text-lg font-medium mb-4"},Te={class:"flex items-center"},Ee=["required"],Ie=["required"],Ge={class:"flex justify-end space-x-3 pt-4"},Je=["disabled"],Ke=Y({name:"MiraLibrary",__name:"index",setup(i){const n=y(!1),a=y(!1),g=y(""),b=y(""),d=y([]),w=y(null),p=y([]),o=y({name:"",path:"",type:"local",description:"",icon:"default",enableHash:!1,serverURL:"",serverPort:"",pluginsDir:""}),v=Z(()=>p.value.filter(l=>{const t=g.value.toLowerCase(),s=!g.value||l.name.toLowerCase().includes(t)||l.path&&l.path.toLowerCase().includes(t)||l.description&&l.description.toLowerCase().includes(t),r=!b.value||l.status===b.value;return s&&r})),R=l=>{if(l===0)return"0 B";const t=1024,s=["B","KB","MB","GB","TB"],r=Math.floor(Math.log(l)/Math.log(t));return parseFloat((l/Math.pow(t,r)).toFixed(2))+" "+s[r]},V=()=>k(null,null,function*(){n.value=!0;try{const l=yield C.get("/libraries");p.value=Array.isArray(l.data)?l.data:[]}catch(l){u.error({message:"加载失败",description:"加载资源库列表失败，请稍后重试"}),console.error("Failed to load libraries:",l),p.value=[]}finally{n.value=!1}}),q=l=>{const t=d.value.indexOf(l);t>-1?d.value.splice(t,1):d.value.push(l)},A=()=>{d.value.length===v.value.length?d.value=[]:d.value=v.value.map(l=>l.id)},N=l=>{var t;w.value=l,o.value={name:l.name,path:l.path,type:l.type,description:l.description||"",icon:l.icon||"default",enableHash:((t=l.customFields)==null?void 0:t.enableHash)||!1,serverURL:l.serverURL||"",serverPort:l.serverPort||"",pluginsDir:l.pluginsDir||""},a.value=!0},M=()=>{a.value=!1,w.value=null,o.value={name:"",path:"",type:"local",description:"",icon:"default",enableHash:!1,serverURL:"",serverPort:"",pluginsDir:""}},j=()=>k(null,null,function*(){var l,t;if(!o.value.name||!o.value.path){u.error({message:"验证失败",description:"请填写必要的字段"});return}if(o.value.type==="remote"){if(!o.value.serverURL||!o.value.serverPort){u.error({message:"验证失败",description:"远程库需要填写服务器地址和端口"});return}const s=Number(o.value.serverPort);if(isNaN(s)||s<1||s>65535){u.error({message:"验证失败",description:"端口号必须是1-65535之间的数字"});return}}n.value=!0;try{const s=_(_({name:o.value.name,path:o.value.path,type:o.value.type,description:o.value.description,icon:o.value.icon,customFields:{path:o.value.path,enableHash:o.value.enableHash}},o.value.type==="remote"&&{serverURL:o.value.serverURL,serverPort:o.value.serverPort}),o.value.pluginsDir&&{pluginsDir:o.value.pluginsDir});w.value?(yield C.put(`/libraries/${w.value.id}`,s),u.success({message:"更新成功",description:"资源库更新成功"})):(yield C.post("/libraries",s),u.success({message:"创建成功",description:"资源库添加成功"})),M(),yield V()}catch(s){u.error({message:"操作失败",description:((t=(l=s.response)==null?void 0:l.data)==null?void 0:t.message)||"操作失败，请稍后重试"})}finally{n.value=!1}}),z=l=>k(null,null,function*(){var t,s;try{const r=l.status==="active"?"inactive":"active";yield C.put(`/libraries/${l.id}/status`,{status:r});const D=p.value.findIndex(E=>E.id===l.id);D!==-1&&(p.value[D]=S(_({},p.value[D]),{status:r})),u.success({message:"状态更新",description:`资源库已${r==="active"?"启用":"禁用"}`})}catch(r){console.error("Toggle status error:",r),u.error({message:"状态切换失败",description:((s=(t=r.response)==null?void 0:t.data)==null?void 0:s.error)||"状态切换失败，请稍后重试"})}}),T=l=>k(null,null,function*(){var t,s;if(l.status==="active"){u.warning({message:"无法删除",description:"请先禁用资源库再进行删除操作"});return}if(confirm(`确定要删除资源库 "${l.name}" 吗？此操作不可撤销。`))try{yield C.delete(`/libraries/${l.id}`),u.success({message:"删除成功",description:"资源库删除成功"}),yield V()}catch(r){console.error("Delete library error:",r),u.error({message:"删除失败",description:((s=(t=r.response)==null?void 0:t.data)==null?void 0:s.error)||"删除失败，请稍后重试"})}});return ee(()=>{V()}),(l,t)=>(x(),f("div",oe,[e("div",le,[t[13]||(t[13]=e("div",null,[e("h1",{class:"text-2xl font-bold"},"资源库管理"),e("p",{class:"mt-1"},"管理本地和远程资源库，配置插件目录和连接设置")],-1)),e("button",{type:"button",onClick:t[0]||(t[0]=s=>a.value=!0),class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},t[12]||(t[12]=[e("svg",{class:"-ml-1 mr-2 h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),te(" 添加资源库 ")]))]),e("div",ne,[e("div",ae,[t[14]||(t[14]=e("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[e("svg",{class:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1)),m(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>g.value=s),type:"text",placeholder:"搜索资源库...",class:"block w-64 pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-blue-500 focus:border-blue-500"},null,512),[[h,g.value]])]),m(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>b.value=s),class:"block w-32 px-3 py-2 border border-gray-300 rounded-md leading-5 focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500"},t[15]||(t[15]=[e("option",{value:""},"全部状态",-1),e("option",{value:"active"},"活跃",-1),e("option",{value:"inactive"},"未活跃",-1)]),512),[[F,b.value]])]),n.value&&p.value.length===0?(x(),f("div",re,[e("div",ie,[t[17]||(t[17]=e("div",{class:"px-6 py-4 border-b border-gray-200"},[e("div",{class:"h-6 rounded w-1/4"})],-1)),(x(),f(B,null,$(8,s=>e("div",{key:s,class:"px-6 py-4 border-b border-gray-200 last:border-b-0"},t[16]||(t[16]=[se('<div class="flex items-center space-x-4" data-v-c6ea245d><div class="h-4 rounded w-1/4" data-v-c6ea245d></div><div class="h-4 rounded w-1/3" data-v-c6ea245d></div><div class="h-4 rounded w-1/6" data-v-c6ea245d></div><div class="h-4 rounded w-1/6" data-v-c6ea245d></div><div class="h-4 rounded w-1/6" data-v-c6ea245d></div></div>',1)]))),64))])])):(x(),f("div",de,[e("div",ue,[e("table",ce,[e("thead",pe,[e("tr",null,[e("th",ve,[e("input",{type:"checkbox",checked:d.value.length===v.value.length&&v.value.length>0,indeterminate:d.value.length>0&&d.value.length<v.value.length,onChange:A,class:"h-4 w-4 focus:ring-blue-500 border-gray-300 rounded"},null,40,me)]),t[18]||(t[18]=e("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider"},"名称",-1)),t[19]||(t[19]=e("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider"},"路径",-1)),t[20]||(t[20]=e("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider"},"类型",-1)),t[21]||(t[21]=e("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider"},"状态",-1)),t[22]||(t[22]=e("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider"},"文件数",-1)),t[23]||(t[23]=e("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider"},"大小",-1)),t[24]||(t[24]=e("th",{class:"relative px-6 py-3"},[e("span",{class:"sr-only"},"操作")],-1))])]),e("tbody",fe,[(x(!0),f(B,null,$(v.value,s=>(x(),f("tr",{key:s.id},[e("td",xe,[e("input",{type:"checkbox",checked:d.value.includes(s.id),onChange:r=>q(s.id),class:"h-4 w-4 focus:ring-blue-500 border-gray-300 rounded"},null,40,be)]),e("td",ge,[e("div",he,[t[25]||(t[25]=e("div",{class:"text-2xl mr-3"},"📁",-1)),e("div",null,[e("div",ye,c(s.name),1),s.description?(x(),f("div",we,c(s.description),1)):L("",!0)])])]),e("td",ke,[e("div",{class:"text-sm max-w-xs truncate",title:s.path},c(s.path),9,Ce)]),e("td",_e,[e("span",{class:U(["inline-flex px-2 py-1 text-xs font-semibold rounded-full",(s.type==="local","")])},c(s.type==="local"?"本地":"远程"),3)]),e("td",Le,[e("span",{class:U(["inline-flex px-2 py-1 text-xs font-semibold rounded-full",(s.status==="active","")])},c(s.status==="active"?"活跃":"未活跃"),3)]),e("td",Ue,c(s.fileCount||0),1),e("td",Ve,c(R(s.size||0)),1),e("td",De,[e("div",Be,[e("button",{onClick:r=>N(s),class:"px-2 py-1 rounded text-sm"}," 编辑 ",8,Me),e("button",{onClick:r=>z(s),class:U(["px-2 py-1 rounded text-sm",(s.status==="active","")])},c(s.status==="active"?"禁用":"启用"),11,He),e("button",{onClick:r=>T(s),disabled:s.status==="active",class:U(["px-2 py-1 rounded text-sm",s.status==="active"?"cursor-not-allowed":""])}," 删除 ",10,Pe)])])]))),128)),v.value.length===0?(x(),f("tr",Se,[e("td",Fe,[e("div",$e,[t[26]||(t[26]=e("div",{class:"text-4xl mb-2"},"📂",-1)),e("p",Re,c(g.value||b.value?"没有找到匹配的资源库":"暂无资源库"),1),e("p",qe,c(g.value||b.value?"请尝试调整搜索条件":'点击"添加资源库"开始创建'),1)])])])):L("",!0)])])])])),a.value?(x(),f("div",Ae,[e("div",Ne,[e("div",je,[e("h3",ze,c(w.value?"编辑资源库":"添加资源库"),1),e("form",{onSubmit:Q(j,["prevent"]),class:"space-y-4"},[e("div",null,[t[27]||(t[27]=e("label",{class:"block text-sm font-medium mb-1"},"名称",-1)),m(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>o.value.name=s),type:"text",required:"",placeholder:"请输入资源库名称",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500"},null,512),[[h,o.value.name]])]),e("div",null,[t[28]||(t[28]=e("label",{class:"block text-sm font-medium mb-1"},"路径",-1)),m(e("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>o.value.path=s),type:"text",required:"",placeholder:"请输入资源库路径",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500"},null,512),[[h,o.value.path]])]),e("div",null,[t[30]||(t[30]=e("label",{class:"block text-sm font-medium mb-1"},"类型",-1)),m(e("select",{"onUpdate:modelValue":t[5]||(t[5]=s=>o.value.type=s),required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500"},t[29]||(t[29]=[e("option",{value:"local"},"本地",-1),e("option",{value:"remote"},"远程",-1)]),512),[[F,o.value.type]])]),e("div",null,[t[31]||(t[31]=e("label",{class:"block text-sm font-medium mb-1"},"图标",-1)),m(e("input",{"onUpdate:modelValue":t[6]||(t[6]=s=>o.value.icon=s),type:"text",placeholder:"图标名称（默认：default）",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500"},null,512),[[h,o.value.icon]])]),e("div",Te,[m(e("input",{id:"enableHash","onUpdate:modelValue":t[7]||(t[7]=s=>o.value.enableHash=s),type:"checkbox",class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"},null,512),[[W,o.value.enableHash]]),t[32]||(t[32]=e("label",{for:"enableHash",class:"ml-2 block text-sm"}," 启用文件哈希校验 ",-1))]),o.value.type==="remote"?(x(),f(B,{key:0},[e("div",null,[t[33]||(t[33]=e("label",{class:"block text-sm font-medium mb-1"},"服务器地址",-1)),m(e("input",{"onUpdate:modelValue":t[8]||(t[8]=s=>o.value.serverURL=s),type:"text",required:o.value.type==="remote",placeholder:"例如：http://127.0.0.1",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500"},null,8,Ee),[[h,o.value.serverURL]])]),e("div",null,[t[34]||(t[34]=e("label",{class:"block text-sm font-medium mb-1"},"服务器端口",-1)),m(e("input",{"onUpdate:modelValue":t[9]||(t[9]=s=>o.value.serverPort=s),type:"text",required:o.value.type==="remote",placeholder:"例如：3000",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500"},null,8,Ie),[[h,o.value.serverPort]])])],64)):L("",!0),e("div",null,[t[35]||(t[35]=e("label",{class:"block text-sm font-medium mb-1"},"插件目录",-1)),m(e("input",{"onUpdate:modelValue":t[10]||(t[10]=s=>o.value.pluginsDir=s),type:"text",placeholder:"插件目录路径（可选）",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500"},null,512),[[h,o.value.pluginsDir]])]),e("div",null,[t[36]||(t[36]=e("label",{class:"block text-sm font-medium mb-1"},"描述",-1)),m(e("textarea",{"onUpdate:modelValue":t[11]||(t[11]=s=>o.value.description=s),rows:"3",placeholder:"请输入描述（可选）",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500"},null,512),[[h,o.value.description]])]),e("div",Ge,[e("button",{type:"button",onClick:M,class:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"}," 取消 "),e("button",{type:"submit",disabled:n.value,class:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed"},c(n.value?"保存中...":"保存"),9,Je)])],32)])])])):L("",!0)]))}}),Ye=X(Ke,[["__scopeId","data-v-c6ea245d"]]);export{Ye as default};
