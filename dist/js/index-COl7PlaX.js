var k=($,b,u)=>new Promise((a,c)=>{var m=r=>{try{x(u.next(r))}catch(f){c(f)}},p=r=>{try{x(u.throw(r))}catch(f){c(f)}},x=r=>r.done?a(r.value):Promise.resolve(r.value).then(m,p);x((u=u.apply($,b)).next())});import{ay as S,cE as T,bu as M,b1 as W,ca as C,cF as K}from"./bootstrap-CPnRZazZ.js";import{a4 as N,P as g,a9 as q,av as n,ab as l,aB as e,aq as h,aV as w,ai as y,aj as d,F as j,aC as P,x as z,b2 as O}from"../jse/index-index-DUSCGC6b.js";const A={class:"library-plugin-selector"},G={class:"drawer-content"},H={key:0,class:"loading-state"},J={key:1,class:"error-state"},Q={key:2,class:"libraries-list"},U=["onClick"],X={class:"library-info"},Y={class:"route-count"},Z={key:0,class:"empty-state"},ee=N({__name:"LibraryPluginSelector",emits:["librarySelected"],setup($,{emit:b}){const u=b,a=g(!1),c=g(!1),m=g(null),p=g([]),x=()=>{a.value=!a.value,a.value&&p.value.length===0&&f()},r=()=>{a.value=!1},f=()=>k(null,null,function*(){try{c.value=!0,m.value=null;const v=yield T();p.value=v.libraries,v.libraries.length===0&&(m.value="暂无可用的插件素材库")}catch(v){m.value=v instanceof Error?v.message:"加载失败"}finally{c.value=!1}}),R=()=>{f()},L=v=>{r(),u("librarySelected",v)};return q(()=>{f()}),(v,o)=>(l(),n("div",A,[e("button",{class:w(["selector-trigger",{active:a.value}]),onClick:x},[o[1]||(o[1]=e("span",{class:"icon-[lucide--layers] mr-2"},null,-1)),o[2]||(o[2]=e("span",null,"素材库插件",-1)),e("span",{class:w(["icon-[lucide--chevron-down] ml-2 transition-transform",{"rotate-180":a.value}])},null,2)],2),a.value?(l(),n("div",{key:0,class:"plugin-drawer",onClick:o[0]||(o[0]=S(()=>{},["stop"]))},[e("div",{class:"drawer-header"},[o[4]||(o[4]=e("h3",null,"选择素材库插件",-1)),e("button",{class:"close-btn",onClick:r},o[3]||(o[3]=[e("span",{class:"icon-[lucide--x]"},null,-1)]))]),e("div",G,[c.value?(l(),n("div",H,o[5]||(o[5]=[e("span",{class:"icon-[lucide--loader-2] mr-2 animate-spin"},null,-1),y(" 加载中... ")]))):m.value?(l(),n("div",J,[o[7]||(o[7]=e("span",{class:"icon-[lucide--alert-circle] mr-2"},null,-1)),y(" "+d(m.value)+" ",1),e("button",{class:"retry-btn",onClick:R},o[6]||(o[6]=[e("span",{class:"icon-[lucide--refresh-cw] mr-1"},null,-1),y(" 重试 ")]))])):(l(),n("div",Q,[(l(!0),n(j,null,P(p.value,_=>(l(),n("div",{key:_.id,class:"library-item",onClick:t=>L(_)},[e("div",X,[e("h4",null,d(_.name),1),e("span",Y,d(_.routeCount)+" 个插件",1)]),o[8]||(o[8]=e("span",{class:"icon-[lucide--chevron-right] expand-icon"},null,-1))],8,U))),128)),p.value.length===0?(l(),n("div",Z,o[9]||(o[9]=[e("span",{class:"icon-[lucide--package] empty-icon"},null,-1),e("p",null,"暂无可用的插件",-1)]))):h("",!0)]))])])):h("",!0),a.value?(l(),n("div",{key:1,class:"drawer-overlay",onClick:r})):h("",!0)]))}}),E=M(ee,[["__scopeId","data-v-605ed5a4"]]),se={class:"plugin-routes-management"},te={class:"mb-6 flex items-center justify-between"},ne={key:0,class:"bg-muted/50 mb-6 rounded-lg border p-4"},le={class:"flex items-center justify-between"},oe={class:"text-lg font-semibold"},ae={class:"text-muted-foreground text-sm"},ie={key:1,class:"space-y-4"},re={key:0,class:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3"},de={key:1,class:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3"},ue=["onClick"],ce={class:"mb-3 flex items-start justify-between"},me={class:"flex items-center space-x-3"},ve={class:"bg-primary/10 flex h-8 w-8 items-center justify-center rounded"},pe={key:1,class:"icon-[lucide--puzzle] text-primary"},fe={class:"text-sm font-semibold"},xe={class:"text-muted-foreground text-xs"},ge={class:"space-y-2 text-sm"},ye={class:"text-muted-foreground flex items-center"},be={class:"font-mono text-xs"},_e={key:0,class:"text-muted-foreground flex items-center"},he={class:"text-xs"},ke={key:1,class:"text-muted-foreground flex items-center"},we={class:"text-xs"},Ce={class:"mt-3 flex items-center justify-between border-t pt-3"},$e=["onClick"],Re=["onClick"],Le={key:2,class:"py-12 text-center"},Se={class:"text-muted-foreground mb-4"},je={key:2,class:"py-16 text-center"},Pe=N({name:"MiraPluginRoutes",__name:"index",setup($){const b=W(),u=g(!1),a=g(null),c=g([]),m=t=>k(null,null,function*(){a.value=t,yield p(t.id)}),p=t=>k(null,null,function*(){try{u.value=!0;const s=yield K(t);c.value=s}catch(s){C.error("加载插件路由失败"),console.error("Failed to load plugin routes:",s)}finally{u.value=!1}}),x=()=>k(null,null,function*(){a.value&&(yield p(a.value.id),C.success("路由已刷新"))}),r=t=>{var s;return(s=t.meta)!=null&&s.roles&&t.meta.roles.length>0?"受限":"可用"},f=t=>{switch(r(t)){case"受限":return"bg-warning/10 text-warning";case"可用":return"bg-success/10 text-success";default:return"bg-muted text-muted-foreground"}},R=t=>{b.push(t.path)},L=t=>{C.info(`编辑路由: ${t.name}`)},v=t=>{const s=`${t.name}_${Date.now()}`;b.push({path:t.path,query:{pageKey:s}})},o=()=>{C.info("创建新路由功能开发中...")},_=t=>t?t.startsWith("lucide--")?`icon-[${t}]`:`icon-[lucide--${t}]`:"";return q(()=>{}),(t,s)=>(l(),n("div",se,[e("div",te,[s[0]||(s[0]=e("div",null,[e("h1",{class:"text-2xl font-bold"},"插件路由管理"),e("p",{class:"text-muted-foreground mt-1"}," 管理各个素材库的插件路由，查看和配置动态加载的插件页面 ")],-1)),z(E,{onLibrarySelected:m})]),a.value?(l(),n("div",ne,[e("div",le,[e("div",null,[e("h3",oe,d(a.value.name),1),e("p",ae,d(a.value.routeCount)+" 个可用的插件路由 ",1)]),e("button",{class:"bg-primary text-primary-foreground hover:bg-primary/90 rounded-md px-4 py-2 transition-colors",onClick:x},[e("span",{class:w(["icon-[lucide--refresh-cw] mr-2",{"animate-spin":u.value}])},null,2),s[1]||(s[1]=y(" 刷新路由 "))])])])):h("",!0),a.value?(l(),n("div",ie,[u.value?(l(),n("div",re,[(l(),n(j,null,P(6,i=>e("div",{key:i,class:"animate-pulse"},s[2]||(s[2]=[O('<div class="bg-muted/30 space-y-3 rounded-lg p-4" data-v-011dfe92><div class="flex items-center space-x-3" data-v-011dfe92><div class="bg-muted h-8 w-8 rounded" data-v-011dfe92></div><div class="flex-1 space-y-2" data-v-011dfe92><div class="bg-muted h-4 w-3/4 rounded" data-v-011dfe92></div><div class="bg-muted h-3 w-1/2 rounded" data-v-011dfe92></div></div></div><div class="space-y-2" data-v-011dfe92><div class="bg-muted h-3 rounded" data-v-011dfe92></div><div class="bg-muted h-3 w-5/6 rounded" data-v-011dfe92></div></div></div>',1)]))),64))])):c.value.length>0?(l(),n("div",de,[(l(!0),n(j,null,P(c.value,i=>{var D,V,B,F;return l(),n("div",{key:i.path,class:"bg-card cursor-pointer rounded-lg border p-4 transition-shadow hover:shadow-md",onClick:I=>R(i)},[e("div",ce,[e("div",me,[e("div",ve,[(D=i.meta)!=null&&D.icon?(l(),n("span",{key:0,class:w([_(i.meta.icon),"text-primary"])},null,2)):(l(),n("span",pe))]),e("div",null,[e("h4",fe,d(((V=i.meta)==null?void 0:V.title)||i.name),1),e("p",xe,d(i.name),1)])]),e("span",{class:w(["inline-flex items-center rounded-full px-2 py-1 text-xs font-medium",f(i)])},d(r(i)),3)]),e("div",ge,[e("div",ye,[s[3]||(s[3]=e("span",{class:"icon-[lucide--route] mr-2 text-xs"},null,-1)),e("span",be,d(i.path),1)]),(B=i.meta)!=null&&B.roles?(l(),n("div",_e,[s[4]||(s[4]=e("span",{class:"icon-[lucide--shield] mr-2 text-xs"},null,-1)),e("span",he," 需要角色: "+d(i.meta.roles.join(", ")),1)])):h("",!0),(F=i.meta)!=null&&F.order?(l(),n("div",ke,[s[5]||(s[5]=e("span",{class:"icon-[lucide--list-ordered] mr-2 text-xs"},null,-1)),e("span",we,"排序: "+d(i.meta.order),1)])):h("",!0)]),e("div",Ce,[e("button",{class:"text-primary hover:text-primary/80 text-xs transition-colors",onClick:S(I=>L(i),["stop"])},s[6]||(s[6]=[e("span",{class:"icon-[lucide--edit] mr-1"},null,-1),y(" 编辑 ")]),8,$e),e("button",{class:"text-muted-foreground hover:text-foreground text-xs transition-colors",onClick:S(I=>v(i),["stop"])},s[7]||(s[7]=[e("span",{class:"icon-[lucide--external-link] mr-1"},null,-1),y(" 打开 ")]),8,Re)])],8,ue)}),128))])):(l(),n("div",Le,[s[9]||(s[9]=e("div",{class:"bg-muted/30 mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full"},[e("span",{class:"icon-[lucide--route] text-muted-foreground text-2xl"})],-1)),s[10]||(s[10]=e("h3",{class:"mb-2 text-lg font-semibold"},"暂无插件路由",-1)),e("p",Se,d(a.value.name)+" 素材库中暂未配置任何插件路由 ",1),e("button",{class:"bg-primary text-primary-foreground hover:bg-primary/90 rounded-md px-4 py-2 transition-colors",onClick:o},s[8]||(s[8]=[e("span",{class:"icon-[lucide--plus] mr-2"},null,-1),y(" 创建路由 ")]))]))])):(l(),n("div",je,[s[11]||(s[11]=e("div",{class:"bg-muted/30 mx-auto mb-6 flex h-20 w-20 items-center justify-center rounded-full"},[e("span",{class:"icon-[lucide--layers] text-muted-foreground text-3xl"})],-1)),s[12]||(s[12]=e("h3",{class:"mb-2 text-xl font-semibold"},"选择一个素材库",-1)),s[13]||(s[13]=e("p",{class:"text-muted-foreground mb-6"}," 请使用右上角的素材库选择器选择要管理插件路由的素材库 ",-1)),z(E,{onLibrarySelected:m})]))]))}}),Fe=M(Pe,[["__scopeId","data-v-011dfe92"]]);export{Fe as default};
