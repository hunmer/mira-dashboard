var ne=Object.getOwnPropertySymbols;var ke=Object.prototype.hasOwnProperty,Pe=Object.prototype.propertyIsEnumerable;var se=(e,t)=>{var o={};for(var a in e)ke.call(e,a)&&t.indexOf(a)<0&&(o[a]=e[a]);if(e!=null&&ne)for(var a of ne(e))t.indexOf(a)<0&&Pe.call(e,a)&&(o[a]=e[a]);return o};var T=(e,t,o)=>new Promise((a,l)=>{var v=s=>{try{p(o.next(s))}catch(g){l(g)}},c=s=>{try{p(o.throw(s))}catch(g){l(g)}},p=s=>s.done?a(s.value):Promise.resolve(s.value).then(v,c);p((o=o.apply(e,t)).next())});import{m as G}from"./client-DtYIytis.js";import{g as me,m as ve,_ as $,r as ge,P as Ae,a as ae,O as fe,b as I,aM as ze,d as _e,A as Te,w as Be,h as Ie,af as Re,o as Fe,H as le,C as ie,f as Me,x as Ne,V as H,c9 as de,ca as N,bu as Oe}from"./bootstrap-CPnRZazZ.js";import{u as De,T as Ee,C as He}from"./index-BCgS9c4V.js";import{r as je}from"./responsiveObserve-bJ1LBcyN.js";import{R as We}from"./BaseInput-ZenqoygY.js";import{e as Le}from"./index-n9-ArQkr.js";import{R as Ge,aF as qe,a4 as V,a5 as j,J,Y as ue,a9 as ye,n as Y,x as d,P as M,F as ee,ao as Ue,av as W,ab as F,aB as L,ac as b,ai as B,a7 as y,aa as Z,aq as Q,aj as q}from"../jse/index-index-DUSCGC6b.js";import{g as Xe,T as Ve,t as Je,a as Ke}from"./index-CAdIk97D.js";import{P as Ye}from"./colors-ofYEz2iF.js";import{T as Ze}from"./index-B7Hyjluc.js";import{F as Qe,a as U}from"./index-B3D4M2C8.js";import ce,{InputPassword as pe}from"./index-Cwka4K4c.js";import"./index-CBIup3_9.js";import"./shallowequal-BhbZS77P.js";import"./Trigger-BBlHK6Ol.js";import"./ResizeObserver.es-CDE7jhPe.js";import"./_arrayIncludes-B8uzE354.js";import"./Overflow-B72o2PGR.js";import"./collapseMotion-IRy70ZwQ.js";import"./slide-ddnvS3KN.js";import"./useRefs-DL0CxS4f.js";import"./DownOutlined-DdLCEGxW.js";import"./useMergedState-Dl9jynAc.js";import"./EyeOutlined-koE-TdJ_.js";import"./index-B60s6XUk.js";import"./index-C1EGCwpW.js";import"./CheckOutlined-DgDniMN_.js";import"./SearchOutlined-B7HDs4KV.js";import"./move-TRtUWpcO.js";import"./FormItemContext-w0fsuxZa.js";import"./statusUtils-DoLtEY_8.js";import"./index-Dd76ephO.js";import"./index-fa6a_x7w.js";import"./Checkbox-DRp7kWfS.js";import"./index-DdqWSe-9.js";import"./index-DqNsvV-3.js";import"./useFlexGapSupport-Bp-4eT_6.js";const et=e=>{const{antCls:t,componentCls:o,iconCls:a,avatarBg:l,avatarColor:v,containerSize:c,containerSizeLG:p,containerSizeSM:s,textFontSize:g,textFontSizeLG:f,textFontSizeSM:k,borderRadius:m,borderRadiusLG:u,borderRadiusSM:h,lineWidth:x,lineType:P}=e,w=(A,n,r)=>({width:A,height:A,lineHeight:`${A-x*2}px`,borderRadius:"50%",[`&${o}-square`]:{borderRadius:r},[`${o}-string`]:{position:"absolute",left:{_skip_check_:!0,value:"50%"},transformOrigin:"0 center"},[`&${o}-icon`]:{fontSize:n,[`> ${a}`]:{margin:0}}});return{[o]:$($($($({},ge(e)),{position:"relative",display:"inline-block",overflow:"hidden",color:v,whiteSpace:"nowrap",textAlign:"center",verticalAlign:"middle",background:l,border:`${x}px ${P} transparent`,"&-image":{background:"transparent"},[`${t}-image-img`]:{display:"block"}}),w(c,g,m)),{"&-lg":$({},w(p,f,u)),"&-sm":$({},w(s,k,h)),"> img":{display:"block",width:"100%",height:"100%",objectFit:"cover"}})}},tt=e=>{const{componentCls:t,groupBorderColor:o,groupOverlapping:a,groupSpace:l}=e;return{[`${t}-group`]:{display:"inline-flex",[`${t}`]:{borderColor:o},"> *:not(:first-child)":{marginInlineStart:a}},[`${t}-group-popover`]:{[`${t} + ${t}`]:{marginInlineStart:l}}}},Se=me("Avatar",e=>{const{colorTextLightSolid:t,colorTextPlaceholder:o}=e,a=ve(e,{avatarBg:o,avatarColor:t});return[et(a),tt(a)]},e=>{const{controlHeight:t,controlHeightLG:o,controlHeightSM:a,fontSize:l,fontSizeLG:v,fontSizeXL:c,fontSizeHeading3:p,marginXS:s,marginXXS:g,colorBorderBg:f}=e;return{containerSize:t,containerSizeLG:o,containerSizeSM:a,textFontSize:Math.round((v+c)/2),textFontSizeLG:p,textFontSizeSM:l,groupSpace:g,groupOverlapping:-s,groupBorderColor:f}}),he=Symbol("AvatarContextKey"),at=()=>Ge(he,{}),rt=e=>qe(he,e),ot=()=>({prefixCls:String,shape:{type:String,default:"circle"},size:{type:[Number,String,Object],default:()=>"default"},src:String,srcset:String,icon:Ae.any,alt:String,gap:Number,draggable:{type:Boolean,default:void 0},crossOrigin:String,loadError:{type:Function}}),O=V({compatConfig:{MODE:3},name:"AAvatar",inheritAttrs:!1,props:ot(),slots:Object,setup(e,t){let{slots:o,attrs:a}=t;const l=j(!0),v=j(!1),c=j(1),p=j(null),s=j(null),{prefixCls:g}=ae("avatar",e),[f,k]=Se(g),m=at(),u=J(()=>e.size==="default"?m.size:e.size),h=De(),x=Le(()=>{if(typeof e.size!="object")return;const n=je.find(i=>h.value[i]);return e.size[n]}),P=n=>x.value?{width:`${x.value}px`,height:`${x.value}px`,lineHeight:`${x.value}px`,fontSize:`${n?x.value/2:18}px`}:{},w=()=>{if(!p.value||!s.value)return;const n=p.value.offsetWidth,r=s.value.offsetWidth;if(n!==0&&r!==0){const{gap:i=4}=e;i*2<r&&(c.value=r-i*2<n?(r-i*2)/n:1)}},A=()=>{const{loadError:n}=e;(n==null?void 0:n())!==!1&&(l.value=!1)};return ue(()=>e.src,()=>{Y(()=>{l.value=!0,c.value=1})}),ue(()=>e.gap,()=>{Y(()=>{w()})}),ye(()=>{Y(()=>{w(),v.value=!0})}),()=>{var n,r;const{shape:i,src:S,alt:z,srcset:C,draggable:_,crossOrigin:re}=e,xe=(n=m.shape)!==null&&n!==void 0?n:i,D=fe(o,e,"icon"),R=g.value,be={[`${a.class}`]:!!a.class,[R]:!0,[`${R}-lg`]:u.value==="large",[`${R}-sm`]:u.value==="small",[`${R}-${xe}`]:!0,[`${R}-image`]:S&&l.value,[`${R}-icon`]:D,[k.value]:!0},we=typeof u.value=="number"?{width:`${u.value}px`,height:`${u.value}px`,lineHeight:`${u.value}px`,fontSize:D?`${u.value/2}px`:"18px"}:{},oe=(r=o.default)===null||r===void 0?void 0:r.call(o);let E;if(S&&l.value)E=d("img",{draggable:_,src:S,srcset:C,onError:A,alt:z,crossorigin:re},null);else if(D)E=D;else if(v.value||c.value!==1){const K=`scale(${c.value}) translateX(-50%)`,Ce={msTransform:K,WebkitTransform:K,transform:K},$e=typeof u.value=="number"?{lineHeight:`${u.value}px`}:{};E=d(We,{onResize:w},{default:()=>[d("span",{class:`${R}-string`,ref:p,style:$($({},$e),Ce)},[oe])]})}else E=d("span",{class:`${R}-string`,ref:p,style:{opacity:0}},[oe]);return f(d("span",I(I({},a),{},{ref:s,class:be,style:[we,P(!!D),a.style]}),[E]))}}}),nt=e=>{const{componentCls:t,popoverBg:o,popoverColor:a,width:l,fontWeightStrong:v,popoverPadding:c,boxShadowSecondary:p,colorTextHeading:s,borderRadiusLG:g,zIndexPopup:f,marginXS:k,colorBgElevated:m}=e;return[{[t]:$($({},ge(e)),{position:"absolute",top:0,left:{_skip_check_:!0,value:0},zIndex:f,fontWeight:"normal",whiteSpace:"normal",textAlign:"start",cursor:"auto",userSelect:"text","--antd-arrow-background-color":m,"&-rtl":{direction:"rtl"},"&-hidden":{display:"none"},[`${t}-content`]:{position:"relative"},[`${t}-inner`]:{backgroundColor:o,backgroundClip:"padding-box",borderRadius:g,boxShadow:p,padding:c},[`${t}-title`]:{minWidth:l,marginBottom:k,color:s,fontWeight:v},[`${t}-inner-content`]:{color:a}})},Xe(e,{colorBg:"var(--antd-arrow-background-color)"}),{[`${t}-pure`]:{position:"relative",maxWidth:"none",[`${t}-content`]:{display:"inline-block"}}}]},st=e=>{const{componentCls:t}=e;return{[t]:Ye.map(o=>{const a=e[`${o}-6`];return{[`&${t}-${o}`]:{"--antd-arrow-background-color":a,[`${t}-inner`]:{backgroundColor:a},[`${t}-arrow`]:{background:"transparent"}}}})}},lt=e=>{const{componentCls:t,lineWidth:o,lineType:a,colorSplit:l,paddingSM:v,controlHeight:c,fontSize:p,lineHeight:s,padding:g}=e,f=c-Math.round(p*s),k=f/2,m=f/2-o,u=g;return{[t]:{[`${t}-inner`]:{padding:0},[`${t}-title`]:{margin:0,padding:`${k}px ${u}px ${m}px`,borderBottom:`${o}px ${a} ${l}`},[`${t}-inner-content`]:{padding:`${v}px ${u}px`}}}},it=me("Popover",e=>{const{colorBgElevated:t,colorText:o,wireframe:a}=e,l=ve(e,{popoverBg:t,popoverColor:o,popoverPadding:12});return[nt(l),st(l),a&&lt(l),ze(l,"zoom-big")]},e=>{let{zIndexPopupBase:t}=e;return{zIndexPopup:t+30,width:177}}),dt=()=>$($({},Ke()),{content:ie(),title:ie()}),ut=V({compatConfig:{MODE:3},name:"APopover",inheritAttrs:!1,props:Te(dt(),$($({},Je()),{trigger:"hover",placement:"top",mouseEnterDelay:.1,mouseLeaveDelay:.1})),setup(e,t){let{expose:o,slots:a,attrs:l}=t;const v=M();Be(e.visible===void 0),o({getPopupDomNode:()=>{var m,u;return(u=(m=v.value)===null||m===void 0?void 0:m.getPopupDomNode)===null||u===void 0?void 0:u.call(m)}});const{prefixCls:c,configProvider:p}=ae("popover",e),[s,g]=it(c),f=J(()=>p.getPrefixCls()),k=()=>{var m,u;const{title:h=le((m=a.title)===null||m===void 0?void 0:m.call(a)),content:x=le((u=a.content)===null||u===void 0?void 0:u.call(a))}=e,P=!!(Array.isArray(h)?h.length:h),w=!!(Array.isArray(x)?x.length:h);return!P&&!w?null:d(ee,null,[P&&d("div",{class:`${c.value}-title`},[h]),d("div",{class:`${c.value}-inner-content`},[x])])};return()=>{const m=Ie(e.overlayClassName,g.value);return s(d(Ve,I(I(I({},Fe(e,["title","content"])),l),{},{prefixCls:c.value,ref:v,overlayClassName:m,transitionName:Re(f.value,"zoom-big",e.transitionName),"data-popover-inject":!0}),{title:k,default:a.default}))}}}),ct=_e(ut),pt=()=>({prefixCls:String,maxCount:Number,maxStyle:{type:Object,default:void 0},maxPopoverPlacement:{type:String,default:"top"},maxPopoverTrigger:String,size:{type:[Number,String,Object],default:"default"},shape:{type:String,default:"circle"}}),te=V({compatConfig:{MODE:3},name:"AAvatarGroup",inheritAttrs:!1,props:pt(),setup(e,t){let{slots:o,attrs:a}=t;const{prefixCls:l,direction:v}=ae("avatar",e),c=J(()=>`${l.value}-group`),[p,s]=Se(l);return Ue(()=>{const g={size:e.size,shape:e.shape};rt(g)}),()=>{const{maxPopoverPlacement:g="top",maxCount:f,maxStyle:k,maxPopoverTrigger:m="hover",shape:u}=e,h={[c.value]:!0,[`${c.value}-rtl`]:v.value==="rtl",[`${a.class}`]:!!a.class,[s.value]:!0},x=fe(o,e),P=Me(x).map((A,n)=>Ne(A,{key:`avatar-key-${n}`})),w=P.length;if(f&&f<w){const A=P.slice(0,f),n=P.slice(f,w);return A.push(d(ct,{key:"avatar-popover-key",content:n,trigger:m,placement:g,overlayClassName:`${c.value}-popover`},{default:()=>[d(O,{style:k,shape:u},{default:()=>[`+${w-f}`]})]})),p(d("div",I(I({},a),{},{class:h,style:a.style}),[A]))}return p(d("div",I(I({},a),{},{class:h,style:a.style}),[P]))}}});O.Group=te;O.install=function(e){return e.component(O.name,O),e.component(te.name,te),e};class X{static getAdmins(){return T(this,null,function*(){return(yield G.get("/admins")).data})}static createAdmin(t){return T(this,null,function*(){return(yield G.post("/admins",t)).data})}static updateAdmin(t,o){return T(this,null,function*(){return(yield G.put(`/api/admins/${t}`,o)).data})}static deleteAdmin(t){return T(this,null,function*(){return(yield G.delete(`/api/admins/${t}`)).data})}}const mt={class:"p-4"},vt={class:"mb-6 flex items-center justify-between"},gt={key:0,class:"flex items-center space-x-3"},ft={class:"font-medium"},yt={key:4,class:"flex space-x-2"},St=V({name:"MiraAdmin",__name:"index",setup(e){const t=M(!1),o=M(!1),a=M(!1),l=M(null),v=M(),c=J(()=>{const n=sessionStorage.getItem("user");if(n)try{return JSON.parse(n).id}catch(r){return null}return null}),p=M([]),s=M({username:"",email:"",password:"",confirmPassword:""}),g=[{title:"用户名",dataIndex:"username",key:"username",width:200},{title:"邮箱",dataIndex:"email",key:"email",width:250},{title:"角色",dataIndex:"role",key:"role",width:100},{title:"创建时间",dataIndex:"createdAt",key:"createdAt",width:180},{title:"最后更新",dataIndex:"updatedAt",key:"updatedAt",width:180},{title:"操作",key:"actions",width:150,fixed:"right"}],k={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"用户名长度为3-20个字符",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度不能少于6位",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认密码",trigger:"blur"},{validator:(n,r)=>r!==s.value.password?Promise.reject(new Error("两次输入的密码不一致")):Promise.resolve(),trigger:"blur"}]},m=n=>new Date(n).toLocaleString("zh-CN"),u=()=>{a.value=!1,l.value=null,s.value={username:"",email:"",password:"",confirmPassword:""},v.value&&v.value.resetFields()},h=()=>T(null,null,function*(){t.value=!0;try{p.value=yield X.getAdmins()}catch(n){N.error("加载管理员列表失败"),console.error("Failed to load admins:",n),p.value=[]}finally{t.value=!1}}),x=n=>{l.value=n,s.value={username:n.username,email:n.email,password:"",confirmPassword:""},a.value=!0},P=()=>T(null,null,function*(){if(v.value)try{yield v.value.validate(),yield w()}catch(n){console.error("Form validation failed:",n)}}),w=()=>T(null,null,function*(){var r,i,S,z;o.value=!0;try{if(l.value)yield X.updateAdmin(l.value.id,{email:s.value.email}),N.success("管理员信息更新成功");else{const n=s.value,{confirmPassword:C}=n,_=se(n,["confirmPassword"]);(yield X.createAdmin(_)).success&&N.success("管理员添加成功")}u(),yield h()}catch(C){console.error("Save admin error:",C);const _=((i=(r=C.response)==null?void 0:r.data)==null?void 0:i.message)||((z=(S=C.response)==null?void 0:S.data)==null?void 0:z.error)||C.message||"操作失败，请稍后重试";N.error(_)}finally{o.value=!1}}),A=n=>T(null,null,function*(){var r,i,S,z;try{yield new Promise((C,_)=>{de.confirm({title:"确认删除",content:`确定要删除管理员 "${n.username}" 吗？此操作不可撤销。`,okText:"确定",cancelText:"取消",onOk:()=>C(),onCancel:()=>_(new Error("用户取消操作"))})}),yield X.deleteAdmin(n.id),N.success("管理员删除成功"),yield h()}catch(C){if(C.message!=="用户取消操作"){console.error("Delete admin error:",C);const _=((i=(r=C.response)==null?void 0:r.data)==null?void 0:i.message)||((z=(S=C.response)==null?void 0:S.data)==null?void 0:z.error)||"删除失败";N.error(_)}}});return ye(()=>{h()}),(n,r)=>(F(),W("div",mt,[L("div",vt,[r[7]||(r[7]=L("div",null,[L("h1",{class:"text-2xl font-bold"},"管理员管理"),L("p",{class:"mt-1 text-sm"},"管理系统管理员账户，包括创建、编辑和删除操作")],-1)),d(y(H),{type:"primary",onClick:r[0]||(r[0]=i=>a.value=!0)},{default:b(()=>r[6]||(r[6]=[B(" ➕ 添加管理员 ")])),_:1,__:[6]})]),d(y(He),null,{default:b(()=>[d(y(Ee),{loading:t.value,dataSource:p.value,columns:g,pagination:{pageSize:10},"row-key":"id"},{bodyCell:b(({column:i,record:S})=>[i.key==="username"?(F(),W("div",gt,[d(y(O),{size:"small"},{default:b(()=>r[8]||(r[8]=[B(" 👤 ")])),_:1,__:[8]}),L("span",ft,q(S.username),1)])):i.key==="role"?(F(),Z(y(Ze),{key:1,color:"blue"},{default:b(()=>[B(q(S.role==="admin"?"管理员":"用户"),1)]),_:2},1024)):i.key==="createdAt"?(F(),W(ee,{key:2},[B(q(m(S.createdAt)),1)],64)):i.key==="updatedAt"?(F(),W(ee,{key:3},[B(q(m(S.updatedAt)),1)],64)):i.key==="actions"?(F(),W("div",yt,[d(y(H),{size:"small",onClick:z=>x(S)},{default:b(()=>r[9]||(r[9]=[B(" ✏️ 编辑 ")])),_:2,__:[9]},1032,["onClick"]),d(y(H),{size:"small",danger:"",disabled:S.id===c.value,onClick:z=>A(S)},{default:b(()=>r[10]||(r[10]=[B(" 🗑️ 删除 ")])),_:2,__:[10]},1032,["disabled","onClick"])])):Q("",!0)]),_:1},8,["loading","dataSource"])]),_:1}),d(y(de),{open:a.value,"onUpdate:open":r[5]||(r[5]=i=>a.value=i),title:l.value?"编辑管理员":"添加管理员",width:"500px",onCancel:u},{footer:b(()=>[d(y(H),{onClick:u},{default:b(()=>r[11]||(r[11]=[B("取消")])),_:1,__:[11]}),d(y(H),{type:"primary",loading:o.value,onClick:P},{default:b(()=>r[12]||(r[12]=[B(" 确定 ")])),_:1,__:[12]},8,["loading"])]),default:b(()=>[d(y(Qe),{ref_key:"formRef",ref:v,model:s.value,rules:k,"label-col":{span:6},"wrapper-col":{span:18}},{default:b(()=>[d(y(U),{label:"用户名",name:"username"},{default:b(()=>[d(y(ce),{value:s.value.username,"onUpdate:value":r[1]||(r[1]=i=>s.value.username=i),placeholder:"请输入用户名",disabled:!!l.value},null,8,["value","disabled"])]),_:1}),d(y(U),{label:"邮箱",name:"email"},{default:b(()=>[d(y(ce),{value:s.value.email,"onUpdate:value":r[2]||(r[2]=i=>s.value.email=i),placeholder:"请输入邮箱地址",type:"email"},null,8,["value"])]),_:1}),l.value?Q("",!0):(F(),Z(y(U),{key:0,label:"密码",name:"password"},{default:b(()=>[d(y(pe),{value:s.value.password,"onUpdate:value":r[3]||(r[3]=i=>s.value.password=i),placeholder:"请输入密码"},null,8,["value"])]),_:1})),l.value?Q("",!0):(F(),Z(y(U),{key:1,label:"确认密码",name:"confirmPassword"},{default:b(()=>[d(y(pe),{value:s.value.confirmPassword,"onUpdate:value":r[4]||(r[4]=i=>s.value.confirmPassword=i),placeholder:"请确认密码"},null,8,["value"])]),_:1}))]),_:1},8,["model"])]),_:1},8,["open","title"])]))}}),ra=Oe(St,[["__scopeId","data-v-b5b0b4ad"]]);export{ra as default};
