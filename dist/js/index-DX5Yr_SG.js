var g=(b,i,r)=>new Promise((n,m)=>{var k=d=>{try{p(r.next(d))}catch(v){m(v)}},B=d=>{try{p(r.throw(d))}catch(v){m(v)}},p=d=>d.done?n(d.value):Promise.resolve(d.value).then(k,B);p((r=r.apply(b,i)).next())});import{a4 as j,J as F,av as l,ab as a,aV as D,aB as s,aj as c,P as f,a9 as N,ai as R,F as h,aC as y,b2 as I,x,aq as G}from"../jse/index-index-DUSCGC6b.js";import{bu as C,cD as M}from"./bootstrap-CPnRZazZ.js";import{m as _}from"./client-DtYIytis.js";const H={class:"flex items-center justify-between"},P={class:"text-sm text-foreground mb-1"},U={class:"text-2xl font-bold"},E={class:"stat-icon"},T={class:"icon-wrapper"},q=j({__name:"StatCard",props:{title:{},value:{},icon:{},color:{}},setup(b){const i=b,r=F(()=>{switch(i.icon){case"Folder":return"📁";case"Grid":return"🧩";case"User":return"👤";case"DataBase":return"💾";default:return"📁"}});return(n,m)=>(a(),l("div",{class:D(["stat-card bg-background text-foreground rounded-lg shadow-sm p-6",`stat-card--${n.color}`])},[s("div",H,[s("div",null,[s("p",P,c(n.title),1),s("p",U,c(n.value),1)]),s("div",E,[s("div",T,c(r.value),1)])])],2))}}),w=C(q,[["__scopeId","data-v-bfdb3975"]]),J={class:"mira-overview"},K={class:"flex justify-between items-center mb-6"},L=["disabled"],O={key:0,class:"animate-spin -ml-1 mr-3 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Q={key:1,class:"-ml-1 mr-2 h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},W={key:0,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8"},X={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8"},Y={key:2,class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},Z={class:"rounded-lg shadow-sm p-6 animate-pulse"},ss={class:"space-y-3"},es={class:"rounded-lg shadow-sm p-6 animate-pulse"},ts={class:"space-y-3"},os={key:3,class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},ls={class:"rounded-lg shadow-sm p-6"},as={class:"space-y-3"},rs={class:"flex justify-between items-center py-2 border-b border-gray-100 last:border-b-0"},is={class:"font-medium"},ns={class:"flex justify-between items-center py-2 border-b border-gray-100 last:border-b-0"},ds={class:"font-medium"},cs={class:"flex justify-between items-center py-2 border-b border-gray-100 last:border-b-0"},us={class:"font-medium"},ms={class:"rounded-lg shadow-sm p-6"},vs={class:"space-y-3"},ps={class:"flex-1"},bs={class:"text-sm font-medium"},gs={class:"text-xs mt-1"},fs={key:0,class:"text-center py-8"},hs=j({name:"MiraOverview",__name:"index",setup(b){const i=f(!1),r=f({libraries:0,plugins:0,admins:0,dbSize:"0 MB"}),n=f({uptime:"0天 0小时",version:"1.0.0",nodeVersion:"18.0.0"}),m=f([{id:1,message:"系统启动完成",time:"刚刚"},{id:2,message:"管理员登录",time:"5分钟前"},{id:3,message:"新增资源库",time:"1小时前"}]),k=t=>{if(t===0)return"0 B";const e=1024,o=["B","KB","MB","GB","TB"],u=Math.floor(Math.log(t)/Math.log(e));return parseFloat((t/Math.pow(e,u)).toFixed(2))+" "+o[u]},B=t=>{const e=Math.floor(t/86400),o=Math.floor(t%86400/3600),u=Math.floor(t%3600/60);return e>0?`${e}天 ${o}小时`:o>0?`${o}小时 ${u}分钟`:`${u}分钟`},p=()=>g(null,null,function*(){try{const[t,e,o]=yield Promise.all([_.get("/libraries"),_.get("/plugins"),_.get("/admins")]),u=Array.isArray(t.data)?t.data:[],V=Array.isArray(e.data)?e.data:[],$=Array.isArray(o.data)?o.data:[],S=u.reduce((z,A)=>z+(A.size||0),0);r.value={libraries:u.length,plugins:V.length,admins:$.length,dbSize:k(S)},m.value=[]}catch(t){console.error("加载统计数据失败:",t),M.error({message:"加载失败",description:"加载统计数据失败，请稍后重试"})}}),d=()=>g(null,null,function*(){try{const e=(yield _.get("/health")).data;n.value={uptime:B(e.uptime||0),version:e.version||"1.0.0",nodeVersion:e.nodeVersion||"18.0.0"}}catch(t){console.error("加载系统信息失败:",t),n.value={uptime:"未知",version:"1.0.0",nodeVersion:"18.0.0"}}}),v=()=>g(null,null,function*(){i.value=!0;try{yield Promise.all([p(),d()])}catch(t){console.error("刷新数据失败:",t),M.error({message:"刷新失败",description:"刷新数据失败，请稍后重试"})}finally{i.value=!1}});return N(()=>{v()}),(t,e)=>(a(),l("div",J,[s("div",K,[e[2]||(e[2]=s("div",null,[s("h1",{class:"text-2xl font-bold"},"系统概览"),s("p",{class:"mt-1"},"Mira管理系统运行状态概览")],-1)),s("button",{type:"button",disabled:i.value,onClick:v,class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed"},[i.value?(a(),l("svg",O,e[0]||(e[0]=[s("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),s("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):(a(),l("svg",Q,e[1]||(e[1]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)]))),R(" "+c(i.value?"加载中...":"刷新数据"),1)],8,L)]),i.value&&r.value.libraries===0?(a(),l("div",W,[(a(),l(h,null,y(4,o=>s("div",{key:o,class:"rounded-lg shadow-sm p-6 animate-pulse"},e[3]||(e[3]=[I('<div class="flex items-center justify-between" data-v-b9b65e42><div class="flex-1" data-v-b9b65e42><div class="h-4 rounded w-3/4 mb-2" data-v-b9b65e42></div><div class="h-8 rounded w-1/2" data-v-b9b65e42></div></div><div class="w-12 h-12 rounded-lg" data-v-b9b65e42></div></div>',1)]))),64))])):(a(),l("div",X,[x(w,{title:"资源库总数",value:r.value.libraries,icon:"Folder",color:"blue"},null,8,["value"]),x(w,{title:"插件总数",value:r.value.plugins,icon:"Grid",color:"green"},null,8,["value"]),x(w,{title:"管理员数量",value:r.value.admins,icon:"User",color:"purple"},null,8,["value"]),x(w,{title:"数据库大小",value:r.value.dbSize,icon:"DataBase",color:"orange"},null,8,["value"])])),i.value?(a(),l("div",Y,[s("div",Z,[e[5]||(e[5]=s("div",{class:"h-6 rounded w-1/3 mb-4"},null,-1)),s("div",ss,[(a(),l(h,null,y(4,o=>s("div",{key:o,class:"flex justify-between"},e[4]||(e[4]=[s("div",{class:"h-4 rounded w-1/3"},null,-1),s("div",{class:"h-4 rounded w-1/4"},null,-1)]))),64))])]),s("div",es,[e[7]||(e[7]=s("div",{class:"h-6 rounded w-1/3 mb-4"},null,-1)),s("div",ts,[(a(),l(h,null,y(3,o=>s("div",{key:o,class:"flex items-center p-3 rounded"},e[6]||(e[6]=[s("div",{class:"w-6 h-6 rounded mr-3"},null,-1),s("div",{class:"flex-1"},[s("div",{class:"h-4 rounded w-3/4 mb-1"}),s("div",{class:"h-3 rounded w-1/2"})],-1)]))),64))])])])):(a(),l("div",os,[s("div",ls,[e[12]||(e[12]=s("div",{class:"flex items-center mb-4"},[s("div",{class:"w-6 h-6 mr-3"},"💻"),s("h3",{class:"text-lg font-semibold"},"系统信息")],-1)),s("div",as,[e[11]||(e[11]=s("div",{class:"flex justify-between items-center py-2 border-b border-gray-100 last:border-b-0"},[s("span",{class:""},"服务器状态"),s("span",{class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"}," 运行中 ")],-1)),s("div",rs,[e[8]||(e[8]=s("span",{class:""},"运行时间",-1)),s("span",is,c(n.value.uptime),1)]),s("div",ns,[e[9]||(e[9]=s("span",{class:""},"系统版本",-1)),s("span",ds,c(n.value.version),1)]),s("div",cs,[e[10]||(e[10]=s("span",{class:""},"Node.js 版本",-1)),s("span",us,c(n.value.nodeVersion),1)])])]),s("div",ms,[e[15]||(e[15]=s("div",{class:"flex items-center mb-4"},[s("div",{class:"w-6 h-6 mr-3"},"📊"),s("h3",{class:"text-lg font-semibold"},"最近活动")],-1)),s("div",vs,[(a(!0),l(h,null,y(m.value,o=>(a(),l("div",{key:o.id,class:"flex items-center p-3 rounded-lg"},[e[13]||(e[13]=s("div",{class:"w-6 h-6 mr-3"},"ℹ️",-1)),s("div",ps,[s("p",bs,c(o.message),1),s("p",gs,c(o.time),1)])]))),128)),m.value.length===0?(a(),l("div",fs,e[14]||(e[14]=[s("div",{class:"text-4xl mb-2"},"📋",-1),s("p",null,"暂无最近活动",-1)]))):G("",!0)])])]))]))}}),ks=C(hs,[["__scopeId","data-v-b9b65e42"]]);export{ks as default};
