var x=(C,v,d)=>new Promise((f,m)=>{var y=l=>{try{o(d.next(l))}catch(r){m(r)}},c=l=>{try{o(d.throw(l))}catch(r){m(r)}},o=l=>l.done?f(l.value):Promise.resolve(l.value).then(y,c);o((d=d.apply(C,v)).next())});import{m as _}from"./client-DtYIytis.js";import{V as h,c9 as q,ca as g,bu as V}from"./bootstrap-CPnRZazZ.js";import{T as w,C as $}from"./index-BCgS9c4V.js";import{Textarea as j}from"./index-Cwka4K4c.js";import{a4 as O,P as i,J as L,a9 as U,av as Q,ab as b,aB as n,x as u,ac as p,ai as S,a7 as s,aa as F,aq as z,aj as R}from"../jse/index-index-DUSCGC6b.js";import"./index-CBIup3_9.js";import"./shallowequal-BhbZS77P.js";import"./Trigger-BBlHK6Ol.js";import"./ResizeObserver.es-CDE7jhPe.js";import"./_arrayIncludes-B8uzE354.js";import"./Overflow-B72o2PGR.js";import"./BaseInput-ZenqoygY.js";import"./index-CAdIk97D.js";import"./colors-ofYEz2iF.js";import"./collapseMotion-IRy70ZwQ.js";import"./slide-ddnvS3KN.js";import"./useRefs-DL0CxS4f.js";import"./responsiveObserve-bJ1LBcyN.js";import"./DownOutlined-DdLCEGxW.js";import"./useMergedState-Dl9jynAc.js";import"./EyeOutlined-koE-TdJ_.js";import"./index-n9-ArQkr.js";import"./index-C1EGCwpW.js";import"./CheckOutlined-DgDniMN_.js";import"./SearchOutlined-B7HDs4KV.js";import"./move-TRtUWpcO.js";import"./index-DdqWSe-9.js";import"./index-B60s6XUk.js";import"./FormItemContext-w0fsuxZa.js";import"./statusUtils-DoLtEY_8.js";import"./index-Dd76ephO.js";import"./index-fa6a_x7w.js";import"./Checkbox-DRp7kWfS.js";import"./index-DqNsvV-3.js";const A={class:"p-4"},E={class:"header-section"},J={class:"header-actions"},P={class:"modal-section"},G={key:0,class:"sql-result"},H={class:"result-title"},K=O({name:"MiraDatabase",__name:"index",setup(C){const v=i(!1),d=i(!1),f=i(!1),m=i(!1),y=i(""),c=i(""),o=i([]),l=i([]),r=i([]),B=[{title:"表名",dataIndex:"name",key:"name",width:200},{title:"结构",dataIndex:"schema",key:"schema",width:150},{title:"行数",dataIndex:"rowCount",key:"rowCount",width:100},{title:"操作",key:"actions",width:120}],D=L(()=>o.value.length===0?[]:Object.keys(o.value[0]).map(a=>({title:a,dataIndex:a,key:a,width:120,ellipsis:!0}))),I=L(()=>r.value.length===0?[]:Object.keys(r.value[0]).map(a=>({title:a,dataIndex:a,key:a,width:150,ellipsis:!0}))),k=()=>x(null,null,function*(){v.value=!0;try{const a=yield _.get("/database/tables");l.value=a.data||[]}catch(a){g.error("加载数据库表失败"),console.error("Failed to load tables:",a)}finally{v.value=!1}}),T=a=>x(null,null,function*(){y.value=a.name,m.value=!0,d.value=!0;try{const e=yield _.get(`/database/tables/${a.name}/data`);r.value=e.data||[]}catch(e){g.error("加载表数据失败"),console.error("Failed to load table data:",e),r.value=[]}finally{d.value=!1}}),M=()=>x(null,null,function*(){var a,e;if(!c.value.trim()){g.warning("请输入SQL查询语句");return}try{const t=yield _.post("/database/query",{sql:c.value});o.value=t.data||[],g.success(`查询执行成功，返回 ${o.value.length} 条记录`)}catch(t){g.error(((e=(a=t.response)==null?void 0:a.data)==null?void 0:e.message)||"SQL执行失败")}});return U(()=>{k()}),(a,e)=>(b(),Q("div",A,[n("div",E,[e[6]||(e[6]=n("div",null,[n("h1",{class:"page-title"},"数据库预览器"),n("p",{class:"page-description"},"查看和管理SQLite数据库表结构和数据")],-1)),n("div",J,[u(s(h),{onClick:k},{default:p(()=>e[4]||(e[4]=[n("span",{style:{"margin-right":"4px"}},"🔄",-1),S(" 刷新 ")])),_:1,__:[4]}),u(s(h),{type:"primary",onClick:e[0]||(e[0]=t=>f.value=!0)},{default:p(()=>e[5]||(e[5]=[n("span",{style:{"margin-right":"4px"}},"📝",-1),S(" SQL查询 ")])),_:1,__:[5]})])]),u(s($),{title:"数据库表"},{default:p(()=>[u(s(w),{loading:v.value,dataSource:l.value,columns:B,pagination:{pageSize:10},"row-key":"name"},{bodyCell:p(({column:t,record:N})=>[t.key==="actions"?(b(),F(s(h),{key:0,size:"small",type:"primary",onClick:W=>T(N)},{default:p(()=>e[7]||(e[7]=[S(" 查看数据 ")])),_:2,__:[7]},1032,["onClick"])):z("",!0)]),_:1},8,["loading","dataSource"])]),_:1}),u(s(q),{open:f.value,"onUpdate:open":e[2]||(e[2]=t=>f.value=t),title:"SQL查询",width:"800px",onOk:M},{default:p(()=>[n("div",P,[u(s(j),{value:c.value,"onUpdate:value":e[1]||(e[1]=t=>c.value=t),rows:6,placeholder:"请输入SQL查询语句..."},null,8,["value"])]),o.value.length>0?(b(),Q("div",G,[n("h4",H,"查询结果 ("+R(o.value.length)+" 条记录)",1),u(s(w),{dataSource:o.value,columns:D.value,scroll:{x:800,y:300},size:"small",pagination:{pageSize:10}},null,8,["dataSource","columns"])])):z("",!0)]),_:1},8,["open"]),u(s(q),{open:m.value,"onUpdate:open":e[3]||(e[3]=t=>m.value=t),title:`表数据: ${y.value}`,width:"1000px"},{default:p(()=>[u(s(w),{loading:d.value,dataSource:r.value,columns:I.value,scroll:{x:800,y:400},size:"small",pagination:{pageSize:20}},null,8,["loading","dataSource","columns"])]),_:1},8,["open","title"])]))}}),Ie=V(K,[["__scopeId","data-v-92e5f31d"]]);export{Ie as default};
