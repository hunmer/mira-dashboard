var b=(d,u,n)=>new Promise((l,m)=>{var t=s=>{try{r(n.next(s))}catch(c){m(c)}},a=s=>{try{r(n.throw(s))}catch(c){m(c)}},r=s=>s.done?l(s.value):Promise.resolve(s.value).then(t,a);r((n=n.apply(d,u)).next())});import{b1 as _,b0 as e,b2 as k,bP as x}from"./bootstrap-CPnRZazZ.js";import{T as $}from"./auth-title-CAfFe8B1.js";import{a4 as v,T as B,J as C,av as N,ab as V,x as w,aB as y,ac as T,a8 as P,ai as h,aj as p,a7 as i,aV as A,P as F,k as S,aa as R}from"../jse/index-index-DUSCGC6b.js";import{u as I,s as g,b as D,l as E}from"./use-vben-form-CIxWieLv.js";import"./render-content.vue_vue_type_script_lang-BENyTHol.js";const L={class:"mt-4 text-center text-sm"},q=v({name:"RegisterForm",__name:"register",props:{formSchema:{default:()=>[]},loading:{type:Boolean,default:!1},loginPath:{default:"/auth/login"},title:{default:""},subTitle:{default:""},submitButtonText:{default:""}},emits:["submit"],setup(d,{expose:u,emit:n}){const l=d,m=n,[t,a]=I(B({commonConfig:{hideLabel:!0,hideRequiredMark:!0},schema:C(()=>l.formSchema),showDefaultActions:!1})),r=_();function s(){return b(this,null,function*(){const{valid:o}=yield a.validate(),f=yield a.getValues();o&&m("submit",f)})}function c(){r.push(l.loginPath)}return u({getFormApi:()=>a}),(o,f)=>(V(),N("div",null,[w($,null,{desc:T(()=>[P(o.$slots,"subTitle",{},()=>[h(p(o.subTitle||i(e)("authentication.signUpSubtitle")),1)])]),default:T(()=>[P(o.$slots,"title",{},()=>[h(p(o.title||i(e)("authentication.createAnAccount"))+" 🚀 ",1)])]),_:3}),w(i(t)),w(i(k),{class:A([{"cursor-wait":o.loading},"mt-2 w-full"]),loading:o.loading,"aria-label":"register",onClick:s},{default:T(()=>[P(o.$slots,"submitButtonText",{},()=>[h(p(o.submitButtonText||i(e)("authentication.signUp")),1)])]),_:3},8,["class","loading"]),y("div",L,[h(p(i(e)("authentication.alreadyHaveAccount"))+" ",1),y("span",{class:"vben-link text-sm font-normal",onClick:f[0]||(f[0]=U=>c())},p(i(e)("authentication.goToLogin")),1)])]))}}),K=v({name:"Register",__name:"register",setup(d){const u=x(),n=F(!1),l=C(()=>[{component:"VbenInput",componentProps:{placeholder:e("authentication.usernameTip")},fieldName:"username",label:e("authentication.username"),rules:g().min(3,{message:e("authentication.usernameTip")}).max(30,{message:"用户名长度不能超过30个字符"}).regex(/^\w+$/,{message:"用户名只能包含字母、数字和下划线"})},{component:"VbenInputPassword",componentProps:{passwordStrength:!0,placeholder:e("authentication.password")},fieldName:"password",label:e("authentication.password"),renderComponentContent(){return{strengthText:()=>e("authentication.passwordStrength")}},rules:g().min(6,{message:e("authentication.passwordTip")}).max(50,{message:"密码长度不能超过50个字符"})},{component:"VbenInput",componentProps:{placeholder:"请输入邮箱地址（可选）",type:"email"},fieldName:"email",label:"邮箱",rules:g().email({message:"请输入有效的邮箱地址"}).optional().or(E(""))},{component:"VbenInputPassword",componentProps:{placeholder:e("authentication.confirmPassword")},dependencies:{rules(t){const{password:a}=t;return g({required_error:e("authentication.passwordTip")}).min(1,{message:e("authentication.passwordTip")}).refine(r=>r===a,{message:e("authentication.confirmPasswordTip")})},triggerFields:["password"]},fieldName:"confirmPassword",label:e("authentication.confirmPassword")},{component:"VbenCheckbox",fieldName:"agreePolicy",renderComponentContent:()=>({default:()=>S("span",[e("authentication.agree"),S("a",{class:"vben-link ml-1 ",href:""},`${e("authentication.privacyPolicy")} & ${e("authentication.terms")}`)])}),rules:D().refine(t=>!!t,{message:e("authentication.agreeTip")})}]);function m(t){return b(this,null,function*(){try{if(n.value=!0,t.password!==t.confirmPassword)throw new Error("两次输入的密码不一致");if(!t.agreePolicy)throw new Error("请同意用户协议和隐私政策");const a={username:t.username,password:t.password,email:t.email||void 0};yield u.authRegister(a)}catch(a){console.error("注册失败:",a)}finally{n.value=!1}})}return(t,a)=>(V(),R(i(q),{"form-schema":l.value,loading:n.value,onSubmit:m},null,8,["form-schema","loading"]))}});export{K as default};
